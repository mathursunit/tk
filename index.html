<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Taaza Khabarein</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="icon" href="icon-192.png" type="image/png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }
  </script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #f2f2f2;
      padding: 1rem;
    }

    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }

    .controls {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    select {
      padding: 0.6rem;
      font-size: 1rem;
      margin: 0 0.5rem;
      border-radius: 6px;
    }

    .news-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
    }

    .news-card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      width: 100%;
      max-width: 320px;
      padding: 1rem;
      display: flex;
      flex-direction: column;
    }

    .news-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }

    .news-image {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 0.75rem;
    }

    .news-title a {
      font-size: 1.1rem;
      font-weight: bold;
      color: #111;
      text-decoration: none;
    }

    .news-title a:hover {
      text-decoration: underline;
    }

    .news-snippet {
      font-size: 0.95rem;
      color: #444;
      margin: 0.75rem 0;
    }

    .timestamp {
      font-size: 0.8rem;
      color: #888;
    }

    .source {
      color: #555;
      font-size: 0.85rem;
      text-align: right;
      font-weight: bold;
    }

    .version-badge {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
      z-index: 1000;
      pointer-events: none;
    }

    .toggle-btn {
      display: block;
      margin: 0 auto 10px auto;
      background: none;
      border: 1px solid #ccc;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      color: #555;
      font-size: 0.9rem;
    }

    .controls {
      text-align: center;
      margin-bottom: 1.5rem;
      display: none;
      /* Hidden by default or toggled */
    }

    .controls.visible {
      display: block;
    }
  </style>
</head>

<body>

  <body>
    <div class="version-badge">v3.10</div>
    <h1>üì∞ Taaza Khabarein</h1>
    <button class="toggle-btn" onclick="toggleControls()">‚öôÔ∏è Filters & Settings</button>
    <div class="controls" id="controls-panel">
      <label for="topicSelect">Topic:</label>
      <select id="topicSelect" onchange="updateTopics()">
        <option value="news">News</option>
        <option value="bollywood">Bollywood</option>
        <option value="hyderabad">Hyderabad</option>
        <option value="syracuse">Syracuse, NY</option>
      </select>
      <label for="sourceSelect">Source:</label>
      <select id="sourceSelect" onchange="loadNews()">
        <!-- Options popluated by JS -->
      </select>
      <label for="refreshInterval">Auto Refresh:</label>
      <select id="refreshInterval" onchange="updateRefreshInterval()">
        <option value="0">Off</option>
        <option value="300000">Every 5 mins</option>
        <option value="600000">Every 10 mins</option>
        <option value="900000" selected>Every 15 mins</option>
      </select>
    </div>
    <div class="news-grid" id="news-container">Loading...</div>
    <script>
      const container = document.getElementById('news-container');
      const sourceSelect = document.getElementById('sourceSelect');
      const topicSelect = document.getElementById('topicSelect');
      const refreshIntervalSelect = document.getElementById('refreshInterval');

      // Data Structure: Topics -> Sources -> { name, url }
      const feedsData = {
        news: {
          ndtv: { name: 'NDTV', url: 'https://feeds.feedburner.com/ndtvnews-top-stories' },
          toi: { name: 'TOI', url: 'https://timesofindia.indiatimes.com/rssfeedstopstories.cms' },
          hindu: { name: 'Hindu', url: 'https://www.thehindu.com/feeder/default.rss' },
          newslaundry: { name: 'Newslaundry', url: 'https://www.newslaundry.com/feed' },
          deccan: { name: 'Deccan Chronicle', url: 'http://www.deccanchronicle.com/rss.xml' },
          ht: { name: 'Hindustan Times', url: 'https://www.hindustantimes.com/feeds/rss/india-news/rssfeed.xml' },
          indianexpress: { name: 'Indian Express', url: 'https://indianexpress.com/section/india/feed/' },
          indiatoday: { name: 'India Today', url: 'https://www.indiatoday.in/rss/1206584' },
          mint: { name: 'LiveMint', url: 'https://www.livemint.com/rss/news' },
          bbc: { name: 'BBC India', url: 'https://feeds.bbci.co.uk/news/world/asia/india/rss.xml' }
        },
        bollywood: {
          hungama: { name: 'Bollywood Hungama', url: 'http://www.bollywoodhungama.com/rss/news.xml' },
          koimoi: { name: 'Koimoi', url: 'https://www.koimoi.com/feed/' },
          toi_ent: { name: 'TOI Entertainment', url: 'https://timesofindia.indiatimes.com/rssfeeds/1081479906.cms' },
          ndtv_movies: { name: 'NDTV Movies', url: 'https://feeds.feedburner.com/ndtvmovies-latest' },
          ht_bollywood: { name: 'HT Bollywood', url: 'https://www.hindustantimes.com/feeds/rss/entertainment/bollywood/rssfeed.xml' },
          filmibeat: { name: 'Filmibeat', url: 'https://www.filmibeat.com/rss/bollywood-news-fb.xml' }
        },
        syracuse: {
          syracuse_com: { name: 'Syracuse.com', url: 'https://www.syracuse.com/arc/outboundfeeds/rss/' },
          wsyr: { name: 'WSYR News 9', url: 'https://www.localsyr.com/feed/' },
          cny_central: { name: 'CNY Central', url: 'https://cnycentral.com/news/local.rss' },
          daily_orange: { name: 'The Daily Orange', url: 'https://dailyorange.com/feed/' },
          urban_cny: { name: 'Urban CNY', url: 'https://www.urbancny.com/feed/' },
          waer: { name: 'WAER 88.3', url: 'https://www.waer.org/rss.xml' }
        },
        hyderabad: {
          siasat: { name: 'Siasat Daily', url: 'https://www.siasat.com/feed/' },
          telangana_today: { name: 'Telangana Today', url: 'https://telanganatoday.com/feed' },
          hindu_hyd: { name: 'The Hindu Hyd', url: 'https://www.thehindu.com/news/cities/Hyderabad/feeder/default.rss' },
          toi_hyd: { name: 'TOI Hyderabad', url: 'https://timesofindia.indiatimes.com/rssfeeds/-2128816011.cms' },
          hans_hyd: { name: 'The Hans India', url: 'https://www.thehansindia.com/rss/hyderabad' },
          deccan_hyd: { name: 'Deccan Chronicle', url: 'https://www.deccanchronicle.com/rss.xml' }
        }
      };

      let refreshTimer = null;

      function updateTopics() {
        const topic = topicSelect.value;
        const sources = feedsData[topic];

        // Clear and populate source select
        sourceSelect.innerHTML = '<option value="all">All Sources</option>';
        for (let key in sources) {
          const opt = document.createElement('option');
          opt.value = key;
          opt.innerText = sources[key].name;
          sourceSelect.appendChild(opt);
        }
        loadNews();
      }

      async function loadNews() {
        container.innerHTML = '<div class="news-card">Loading...</div>'; // Better loading state
        const topic = topicSelect.value;
        const selectedSource = sourceSelect.value;

        let sourcesToFetch = [];
        if (selectedSource === 'all') {
          sourcesToFetch = Object.keys(feedsData[topic]);
        } else {
          sourcesToFetch = [selectedSource];
        }

        container.innerHTML = '';

        for (let key of sourcesToFetch) {
          try {
            const feedInfo = feedsData[topic][key];
            // Use RSS2JSON or a proxy if needed. Note: Some feeds might choke on default proxy.
            // Using rss2json as before.
            const url = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feedInfo.url)}`;

            const res = await fetch(url);
            const data = await res.json();

            if (data.status !== 'ok') throw new Error('Feed failed');

            data.items.forEach(item => {
              const imageUrl = (item.enclosure && item.enclosure.link) ||
                (item.thumbnail) || ''; // Some feeds use thumbnail

              const pubDate = item.pubDate ? new Date(item.pubDate).toLocaleString() : '';

              container.innerHTML += `
              <div class="news-card">
                ${imageUrl ? `<img src="${imageUrl}" class="news-image" alt="Image"/>` : ''}
                <div class="news-title"><a href="${item.link}" target="_blank">${item.title}</a></div>
                <div class="news-snippet">${item.description?.replace(/<[^>]*>?/gm, '').slice(0, 100) || ''}...</div>
                <div class="timestamp">${pubDate}</div>
                <div class="source">${feedInfo.name}</div>
              </div>
            `;
            });
          } catch (e) {
            // container.innerHTML += `<div class="news-card">‚ùå ${key} error</div>`;
            console.error(e);
          }
        }

        if (container.innerHTML === '') {
          container.innerHTML = '<div style="width:100%;text-align:center;">No news found or connection error.</div>';
        }
      }
      function updateRefreshInterval() {
        const interval = parseInt(refreshIntervalSelect.value);
        if (refreshTimer) clearInterval(refreshTimer);
        if (interval > 0) {
          refreshTimer = setInterval(loadNews, interval);
        }
      }
      function toggleControls() {
        const panel = document.getElementById('controls-panel');
        panel.classList.toggle('visible');
      }

      updateTopics(); // Initialize options
      updateRefreshInterval();
    </script>
  </body>

</html>